{% extends 'admin/base.html' %}

{% load i18n %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
{% if subtitle %}
{{ subtitle }} |
{% endif %}

{{ title }} | {{ site_title|default:_('Django site admin') }}
{% endblock %}

{% block branding %}
{% include "unfold/helpers/site_branding.html" %}
{% endblock %}

{% block content %}



<main class="flex-1 max-h-full p-5 overflow-hidden overflow-y-scroll">

    <!-- Start Content -->
    <div class="grid grid-cols-1 gap-5 mt-6">


        <div class="p-4 transition-shadow border rounded-lg shadow-sm hover:shadow-lg">
            <div class="flex items-start justify-between">
                <div class="flex flex-col space-y-2">
                    <span class="text-gray-400">Total Users</span>
                    <span class="text-lg font-semibold">{{total_users}}</span>
                </div>
                <svg fill="{{ system_color }}" width="77px" height="77px" viewBox="0 0 32 32" version="1.1"
                    xmlns="http://www.w3.org/2000/svg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <title>users</title>
                        <path
                            d="M16 21.416c-5.035 0.022-9.243 3.537-10.326 8.247l-0.014 0.072c-0.018 0.080-0.029 0.172-0.029 0.266 0 0.69 0.56 1.25 1.25 1.25 0.596 0 1.095-0.418 1.22-0.976l0.002-0.008c0.825-3.658 4.047-6.35 7.897-6.35s7.073 2.692 7.887 6.297l0.010 0.054c0.127 0.566 0.625 0.982 1.221 0.982 0.69 0 1.25-0.559 1.25-1.25 0-0.095-0.011-0.187-0.031-0.276l0.002 0.008c-1.098-4.78-5.305-8.295-10.337-8.316h-0.002zM9.164 11.102c0 0 0 0 0 0 2.858 0 5.176-2.317 5.176-5.176s-2.317-5.176-5.176-5.176c-2.858 0-5.176 2.317-5.176 5.176v0c0.004 2.857 2.319 5.172 5.175 5.176h0zM9.164 3.25c0 0 0 0 0 0 1.478 0 2.676 1.198 2.676 2.676s-1.198 2.676-2.676 2.676c-1.478 0-2.676-1.198-2.676-2.676v0c0.002-1.477 1.199-2.674 2.676-2.676h0zM22.926 11.102c2.858 0 5.176-2.317 5.176-5.176s-2.317-5.176-5.176-5.176c-2.858 0-5.176 2.317-5.176 5.176v0c0.004 2.857 2.319 5.172 5.175 5.176h0zM22.926 3.25c1.478 0 2.676 1.198 2.676 2.676s-1.198 2.676-2.676 2.676c-1.478 0-2.676-1.198-2.676-2.676v0c0.002-1.477 1.199-2.674 2.676-2.676h0zM31.311 19.734c-0.864-4.111-4.46-7.154-8.767-7.154-0.395 0-0.784 0.026-1.165 0.075l0.045-0.005c-0.93-2.116-3.007-3.568-5.424-3.568-2.414 0-4.49 1.448-5.407 3.524l-0.015 0.038c-0.266-0.034-0.58-0.057-0.898-0.063l-0.009-0c-4.33 0.019-7.948 3.041-8.881 7.090l-0.012 0.062c-0.018 0.080-0.029 0.173-0.029 0.268 0 0.691 0.56 1.251 1.251 1.251 0.596 0 1.094-0.417 1.22-0.975l0.002-0.008c0.684-2.981 3.309-5.174 6.448-5.186h0.001c0.144 0 0.282 0.020 0.423 0.029 0.056 3.218 2.679 5.805 5.905 5.805 3.224 0 5.845-2.584 5.905-5.794l0-0.006c0.171-0.013 0.339-0.035 0.514-0.035 3.14 0.012 5.765 2.204 6.442 5.14l0.009 0.045c0.126 0.567 0.625 0.984 1.221 0.984 0.69 0 1.249-0.559 1.249-1.249 0-0.094-0.010-0.186-0.030-0.274l0.002 0.008zM16 18.416c-0 0-0 0-0.001 0-1.887 0-3.417-1.53-3.417-3.417s1.53-3.417 3.417-3.417c1.887 0 3.417 1.53 3.417 3.417 0 0 0 0 0 0.001v-0c-0.003 1.886-1.53 3.413-3.416 3.416h-0z">
                        </path>
                    </g>
                </svg>
            </div>
            <div>
                <span class="text-sm text-gray-400">New Users : </span>
                <span>{{ current_month_signups }} </span>
            </div>
        </div>

    </div>

    <h3 class="mt-3 text-xl">Users</h3>
    <div class="flex flex-col mt-6 w-full">
        <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8 w-full">
            <div class="inline-block min-w-full py-1 align-middle sm:px-6 lg:px-8 w-full">
                <div class="overflow-hidden border-b border-gray-200 rounded-md shadow-md w-full">
                    <div id="chart" class="py-24"></div>
                </div>
            </div>
        </div>
    </div>

</main>

</div>



<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
    // Define the helper first
    function getChartTooltipTheme() {
        return document.documentElement.classList.contains("dark") ? "dark" : "light";
    }

    document.addEventListener('alpine:initialized', () => {
        // Now Alpine has processed x-bind:class and added 'dark' if needed
        console.log("Alpine initialized, current theme:", getChartTooltipTheme());

        // Now initialize ApexCharts
        initializeChart();
    });

    function initializeChart() {
        var currect_year = new Date().getFullYear();
        var data = JSON.parse("{{ data|escapejs }}"); // Safe escaping

        var options = {
            series: [{
                name: "New Users Signup",
                data: data,
            }],
            tooltip: {
                theme: getChartTooltipTheme() // Correct theme now
            },
            chart: {
                height: 350,
                type: "area",
            },
            colors: ["{{ system_color }}"],
            plotOptions: {
                bar: {
                    borderRadius: 10,
                    dataLabels: {
                        position: "top",
                    },
                },
            },
            dataLabels: {
                enabled: true,
                formatter: function (val) {
                    return val + "%";
                },
                offsetY: -20,
                style: {
                    fontSize: "12px",
                    colors: ["{{ system_color }}"],
                },
                background: {
                    enabled: true,
                    foreColor: "#fff",
                    padding: 4,
                    borderRadius: 2,
                    borderWidth: 0,
                    borderColor: "{{ system_color }}",
                    opacity: 0.9,
                },
            },
            xaxis: {
                categories: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                labels: {
                    style: {
                        colors: "{{ system_color }}",
                        fontSize: "12px",
                    },
                },
                position: "top",
                axisBorder: { show: false },
                axisTicks: { show: false },
                crosshairs: {
                    fill: {
                        type: "gradient",
                        gradient: {
                            colorFrom: "{{ system_color }}",
                            colorTo: "{{ system_color }}",
                            stops: [0, 100],
                            opacityFrom: 0.4,
                            opacityTo: 0.5,
                        },
                    },
                },
                tooltip: { enabled: true },
            },
            yaxis: {
                axisBorder: { show: false },
                axisTicks: { show: false },
                labels: { show: false }
            },
            title: {
                text: `Monthly new Users Signups ${currect_year}`,
                floating: true,
                offsetY: 330,
                align: "center",
                style: {
                    color: "{{ system_color }}",
                },
            },
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();

        // Watch for theme changes
        const observer = new MutationObserver(() => {
            chart.updateOptions({
                tooltip: { theme: getChartTooltipTheme() }
            });
        });

        observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
    }
</script>
{% endblock %}